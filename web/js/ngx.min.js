/*!
 * ramsondon.github.io - ramsondon.github.io v1.0.0 (https://ramsondon.github.io)
 * Copyright 2017 -2017 Matthias Schmid
 * Licensed under MIT
 */
if(_&&"undefined"!=typeof _||(_={}),"registerElement"in document)var ngxApp=document.registerElement("ngx-app"),ngxInclude=document.registerElement("ngx-include");_.ngx=function(){var e=function(){this.base_route="",this.wait_cache_freq=0,this.model_cache={mark:{},cache:{}},this.tpl_cache={mark:{},cache:{}},this.listeners={}};return e.prototype.get=function(e,t){return new Promise(function(n,i){var r=this.base_route+e;fetch(r).then(function(e){return 200!==e.status?void i("Error Report","Status Code: "+e.status,e.statusText):void e[t]().then(function(e){n(e)}.bind(this))}.bind(this))["catch"](function(e){i(e)}.bind(this))}.bind(this))},e.prototype.toKey=function(e){return e.replace(new RegExp("[/.-]","g"),"_")},e.prototype.waitCache=function(e,t){return new Promise(function(n,i){var r=0,c=function(){r>0&&t in e?(clearTimeout(r),r=0,n(t)):r=setTimeout(c,this.wait_cache_freq)}.bind(this);r=setTimeout(c,this.wait_cache_freq)}.bind(this))},e.prototype.render=function(e,t,n,i){return new Promise(function(r,c){var o=function(e){var c=document.createElement("script");c.type="text/x-ngx-tpl",c.innerHTML=e,n.appendChild(c),n.innerHTML=_.template(n.innerHTML)(t),n.innerHTML=n.querySelector("script").innerHTML,this.include(n.querySelectorAll("ngx-include")).then(function(){r(),_.isString(i)&&i in this.listeners&&this.listeners[i]()}.bind(this))}.bind(this);this.cacheResource(e,this.tpl_cache,"text").then(function(e){o(this.tpl_cache.cache[e])}.bind(this))["catch"](function(e){console.warn(e)})}.bind(this))},e.prototype.cacheResource=function(e,t,n){return new Promise(function(i,r){var c=this.toKey(e);c in t.mark?this.waitCache(t.cache,c).then(function(e){i(e)}.bind(this)):(t.mark[c]=e,this.get(e,n).then(function(e){t.cache[c]=e,i(c)}))}.bind(this))},e.prototype.parseInclude=function(e){return{model:e.getAttribute("x-model"),template:e.getAttribute("x-template"),listener:e.getAttribute("x-listen")}},e.prototype.include=function(e){return new Promise(function(t,n){var i=0,r=function(n,r,c){this.render(n.template,{ngxModel:r},c,n.listener).then(function(){++i===e.length&&t()}.bind(this))}.bind(this);_.forEach(e,function(e,t){var n=this.parseInclude(e);if(n.model)try{r(n,this.readAssignment(n.model),e)}catch(i){this.cacheResource(n.model,this.model_cache,"json").then(function(t){r(n,this.model_cache.cache[t],e)}.bind(this))["catch"](function(e){console.warn(e)})}else r(n,null,e)}.bind(this)),e.length<=0&&t()}.bind(this))},e.prototype.nl2br=function(e,t){if(_.isString(e)){var n=t||"undefined"==typeof t?"<br />":"<br>";return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+n+"$2")}return e},e.prototype.assign=function(e){return _.escape(JSON.stringify(e))},e.prototype.readAssignment=function(e){return JSON.parse(_.unescape(e))},e.prototype.ngx=function(){return new Promise(function(e,t){var n=0,i=document.querySelectorAll("ngx-app");_.forEach(i,function(t,r){this.include(t.querySelectorAll("ngx-include")).then(function(){++n===i.length&&e()})}.bind(this)),i.length<=0&&e()}.bind(this))},e.prototype.base=function(e){return this.base_route=e,this},e.prototype.listen=function(e,t){if(_.isObject(e)&&_.isUndefined(t))for(var n in e)this.listen(n,e[n]);else _.isString(e)&&_.isFunction(t)&&(this.listeners[e]=t);return this},e.prototype.require=function(e){return new Promise(function(t,n){return function(e,n,i){var r,c=i.replace(new RegExp("[/.:]","g"),"_"),o=e.getElementsByTagName(n)[0];e.getElementById(c)||(r=e.createElement(n),r.id=c,r.src=i,o.parentNode.insertBefore(r,o),r.readyState?r.onreadystatechange=function(){"loaded"!==r.readyState&&"complete"!==r.readyState||(r.onreadystatechange=null,t())}:r.onload=t)}(document,"script",e)}.bind(this))},new e}();
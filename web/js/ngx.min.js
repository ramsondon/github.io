/*!
 * ramsondon.github.io - ramsondon.github.io v1.0.0 (https://ramsondon.github.io)
 * Copyright 2017 -2017 Matthias Schmid
 * Licensed under MIT
 */
if(_&&"undefined"!=typeof _||(_={}),"registerElement"in document)var ngxApp=document.registerElement("ngx-app"),ngxInclude=document.registerElement("ngx-include");_.ngx=function(){var t=function(){this.base_route="",this.wait_cache_freq=0,this.model_cache={mark:{},cache:{}},this.tpl_cache={mark:{},cache:{}},this.listeners={}};return t.prototype.get=function(t,e){return new Promise(function(n,i){var r=this.base_route+t;fetch(r,{method:"GET"}).then(function(t){return 200!==t.status?void console.error("Error Report","Status Code: "+t.status,t.statusText):void t[e]().then(function(t){n(t)}.bind(this))}.bind(this))["catch"](function(t){i(t)}.bind(this))}.bind(this))},t.prototype.toKey=function(t){return t.replace(new RegExp("[/.-]","g"),"_")},t.prototype.waitCache=function(t,e){return new Promise(function(n,i){var r=0,o=function(){r>0&&e in t?(clearTimeout(r),r=0,n(e)):r=setTimeout(o,this.wait_cache_freq)}.bind(this);r=setTimeout(o,this.wait_cache_freq)}.bind(this))},t.prototype.render=function(t,e,n,i){return new Promise(function(r,o){var c=function(t){var o=document.createElement("script");o.type="text/x-ngx-tpl",o.innerHTML=t,n.appendChild(o),n.innerHTML=_.template(n.innerHTML)(e),n.innerHTML=n.querySelector("script").innerHTML,this.include(n.querySelectorAll("ngx-include")).then(function(){r(),_.isString(i)&&i in this.listeners&&this.listeners[i]()}.bind(this))}.bind(this);this.cacheResource(t,this.tpl_cache,"text").then(function(t){c(this.tpl_cache.cache[t])}.bind(this))["catch"](function(t){console.warn(t)})}.bind(this))},t.prototype.cacheResource=function(t,e,n){return new Promise(function(i,r){var o=this.toKey(t);o in e.mark?this.waitCache(e.cache,o).then(function(t){i(t)}.bind(this)):(e.mark[o]=t,this.get(t,n).then(function(t){e.cache[o]=t,i(o)}))}.bind(this))},t.prototype.parseInclude=function(t){return{model:t.getAttribute("x-model"),template:t.getAttribute("x-template"),listener:t.getAttribute("x-listen")}},t.prototype.include=function(t){return new Promise(function(e,n){var i=0,r=function(n,r,o){this.render(n.template,{ngxModel:r},o,n.listener).then(function(){++i===t.length&&e()}.bind(this))}.bind(this);_.forEach(t,function(t,e){var n=this.parseInclude(t);if(n.model)try{r(n,this.readAssignment(n.model),t)}catch(i){this.cacheResource(n.model,this.model_cache,"json").then(function(e){r(n,this.model_cache.cache[e],t)}.bind(this))["catch"](function(t){console.warn(t)})}else r(n,null,t)}.bind(this)),t.length<=0&&e()}.bind(this))},t.prototype.nl2br=function(t,e){if(_.isString(t)){var n=e||"undefined"==typeof e?"<br />":"<br>";return(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+n+"$2")}return t},t.prototype.assign=function(t){return _.escape(JSON.stringify(t))},t.prototype.readAssignment=function(t){return JSON.parse(_.unescape(t))},t.prototype.ngx=function(){return new Promise(function(t,e){var n=0,i=document.querySelectorAll("ngx-app");_.forEach(i,function(e,r){this.include(e.querySelectorAll("ngx-include")).then(function(){++n===i.length&&t()})}.bind(this)),i.length<=0&&t()}.bind(this))},t.prototype.base=function(t){return this.base_route=t,this},t.prototype.listen=function(t,e){if(_.isObject(t)&&_.isUndefined(e))for(var n in t)this.listen(n,t[n]);else _.isString(t)&&_.isFunction(e)&&(this.listeners[t]=e);return this},t.prototype.require=function(t){return new Promise(function(e,n){return function(t,n,i){var r,o=i.replace(new RegExp("[/.:]","g"),"_"),c=t.getElementsByTagName(n)[0];t.getElementById(o)||(r=t.createElement(n),r.id=o,r.src=i,c.parentNode.insertBefore(r,c),r.readyState?r.onreadystatechange=function(){"loaded"!==r.readyState&&"complete"!==r.readyState||(r.onreadystatechange=null,e())}:r.onload=e)}(document,"script",t)}.bind(this))},t.prototype.start=function(){return new Promise(function(t,e){var n=function(){this.ngx().then(t)}.bind(this);"fetch"in window?n():this.require("https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js").then(n)}.bind(this))},new t}();